clear all;
close all;

t = [0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,5,5,5,5,5,5,5,5,5,5,5,5,5,8,9,9,9,9,10,10,10,11,11,11,11,11,11,11,11,12,12,14,15,15,15,15,15,15,15,15,15,15,15,15,15,17,17,17,17,17,17,17,17,18,18,18,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,31,32,32,32,32,33,33,34,34,34,34,34,34,35,35,38,38,38,38,38,38,38,38,38,38,38,38,38,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,42,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,49,49,49,49,51,54,54,55,56,56,57,57,57,57,57,62,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,64,64,70,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,72,72,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,77,78,78,78,79,79,80,80,80,80,80,80,80,80,80,81,81,84,84,84,84,84,84,84,84,84,84,84,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,87,87,87,87,87,87,99,99,99,99,99,99,99];
o = [108,20,21,22,23,24,28,33,49,60,71,97,103,104,11,12,137,139,150,18,20,22,29,32,35,46,49,52,62,70,85,87,89,90,93,19,30,47,63,108,112,116,121,127,131,142,145,147,75,78,8,82,113,10,124,127,131,125,129,92,106,133,141,144,156,73,76,92,109,5,167,11,112,116,121,126,130,142,145,147,30,47,64,8,104,150,20,32,49,85,87,90,38,55,70,100,104,105,108,109,11,110,115,12,14,17,21,25,28,35,37,40,52,54,6,60,62,74,75,78,79,83,84,87,88,89,94,96,99,102,53,81,123,127,131,135,141,145,150,156,160,65,68,70,142,10,153,156,160,154,158,117,121,52,56,64,67,128,132,11,131,135,141,145,150,155,159,24,36,53,65,68,70,105,108,115,14,25,37,54,6,75,78,84,87,94,96,99,103,109,43,82,88,167,10,105,106,107,108,132,133,137,138,141,142,143,148,150,153,17,18,22,23,26,27,28,33,35,38,39,43,44,47,48,49,54,56,79,80,90,91,93,135,20,41,94,7,0,167,124,152,9,124,152,5,58,9,10,105,107,132,138,141,148,150,17,23,26,33,35,38,44,47,54,56,79,108,136,142,21,27,42,48,78,89,95,167,101,103,126,127,141,157,25,28,29,35,37,39,40,64,65,69,70,73,74,75,80,82,85,86,9,90,91,94,95,96,67,88,107,111,115,119,125,131,133,136,138,162,45,50,56,6,60,42,53,56,60,54,58,105,129,132,135,147,15,160,31,5,112,116,115,119,125,133,136,138,45,50,55,59,6,101,103,127,141,29,40,64,70,73,80,82,85,9,91,94,157,25,68,74,89,95,102,104,17,34,51,68,85];
x = [t;o];
N = length(x); % Total number of coordinates
D = zeros(N,N); % Creating distance matrix of N*N

% generating matrix
for i=1:N-1
    for j=i+1:N
        D(i,j)=norm(x(:,i)-x(:,j));
        D(j,i)=D(i,j);
    end
end


s = randperm(N); % Initial solution
sinit = s;
distance = tour_calculation(s,D); % calculating distance
d_list = distance; p_list = [];
factor = 10; 
epochs = 100000;
for i=1:epochs
     id = randperm(N,2);
     id = sort(id);
     snext = s;

     snext(id(1):id(2))=s(id(2):-1:id(1));% Swapping

     distance_next = tour_calculation(snext,D);
     E = distance-distance_next; % to check for minimum direction
     T = factor/(i);
     prob = 1/(1+exp(-E/T));
     %pE = exp(-E/(T));
     if E>0 
         s = snext;
     else
         ra = rand;
          if ra < prob 
                s = snext;
          end
     end
     distance = tour_calculation(s,D);
     d_list = [d_list, distance];
     p_list = [p_list, prob];
 

 
end 


% plotting graphs for Inital path and Path found by simulated annealing
x0=10;
y0=10;
width=1200;
height=400;
set(gcf,'position',[x0,y0,width,height])

figure(1);
subplot(1,2,1);
axis([0 1 0 1]);plot(x(1,[sinit sinit(1)]),x(2,[sinit sinit(1)]),'-o')
title('Initial Path')
xlabel('x-axis')
ylabel('y-axis')
legend('Connecting paths');
subplot(1,2,2);
axis([0 1 0 1]);



plot(x(1,[s s(1)]),x(2,[s s(1)]),'-o',x(1,s(1)),x(2,s(1)),'r-*');
title('Path after Simulated Annealing algo applied');
xlabel('x-axis');
ylabel('y-axis');
legend('Connecting paths','Start Node');

% Distance calculation / path cost for a tour s
% function for tour calculation
function [dis] = tour_calculation(s,D)
    [N,M] = size(D);
    dis = 0;
    for i=1:N-1
     dis = dis + D(s(i),s(i+1));
    end
    dis = dis + D(s(N),s(1));
end